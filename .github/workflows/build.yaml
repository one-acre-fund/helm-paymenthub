name: Build and Package Helm Chart

on:
  push:
    branches:
      - main
      - develop
      - feature/add_github_actions

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Helm
        uses: azure/setup-helm@v1
        with:
          version: 'latest'

      - name: Initialize Helm Repositories
        run: |
          helm repo add stable https://charts.helm.sh/stable
          helm repo update

      - name: Lint Helm Chart
        run: |
          helm dependency update helm/ph-ee-engine
          helm lint helm/ph-ee-engine

      - name: Package Helm Chart
        run: |
          helm package helm/ph-ee-engine --destination ./artifacts
          ls -l ./artifacts

      - name: Publish Helm Chart
        uses: actions/upload-artifact@v2
        with:
          name: paymenthub
          path: ./artifacts/*
